@model App_Ventas.Areas.Ventas.Models.BuscarProductoModelView
<script>
    var _Valido = false;
    var _ID_SUCURSAL = @Model.ID_SUCURSAL

    $(document).ready(function () {
        $("#file-upload").change(function () {
            $("#Lbl_Namefile").html("Sin archivo cargado...");
            var input = document.getElementById('file-upload');
            var file = input.files[0];
            var PesodeArchivo = parseFloat(file.size);
            var ext = input.files[0].name.split('.').pop();
            var nombre = input.files[0].name;
            if (nombre.length > 100) {
                jAlert("El nombre del archivo es muy largo", 'Alerta');
                $(this).val('');
                return false;
            } else {
                var validopes = false;
                if (PesodeArchivo <= Tamanio_Valido)
                    validopes = true;

                if (!validopes) {
                    $(this).val('');
                    jAlert("El peso del archivo no pueden pesar más de " + Tamanio_Valido / 1024 / 1024 + "Mb", 'Alerta');
                    return false;
                } else {
                    $("#Lbl_Namefile").html(nombre);
                }
            }
        });
    });

    $(function () {
        $(".modal-content").draggable();
    });
    $('#Importar_btn_DPlantilla').click(function () {
        Producto_DescargarPlantillaProducto();
    });

    $('#Producto_Btn_Importar').click(function () {
        Producto_ImportarProducto();
    });

    function Producto_ImportarProducto() {
        var _ID_SUCURSAL = $("#ID_SUCURSAL").val();
        var pregunta = "";
        if (_ID_SUCURSAL == "") {
            jAlert("Alamacen no seleccionado, por favor seleccione uno", "Atención");
            return;
        }
        jConfirm("Antes de continuar favor de asegurarse que el archivo no tenga caracteres especiales [;*_\!,etc] en el nombre y el nombre de la hoja sea Hoja1,"
                  + "si ya hizo todo lo mencionado obvie este mensaje presionando el botón Aceptar para seguir con el proceso", "Atención", function (r) {
            if (r) {
                var url = baseUrl + "Inventario/Importar/CargarArchivo";
                var options = {
                    type: "POST",
                    dataType: "json",
                    //contentType: false,
                    url: url,
                    extraData: ({
                    }),
                    resetForm: true,
                    beforeSubmit: function (formData, jqForm, options) {
                        var queryString = $.param(formData);
                        return true;
                    },
                    success: function (auditoria) {
                        debugger; 
                        $("#Lbl_Namefile").html("Sin archivo cargado...");
                        if (auditoria.EJECUCION_PROCEDIMIENTO) {
                            if (!auditoria.RECHAZAR) {
                                jOkas('El proceso de carga ha culminado', 'Alerta');

                            } else {
                                jError(auditoria.MENSAJE_SALIDA, 'Atención');
                            }
                        }
                        else {
                            jError(auditoria.MENSAJE_SALIDA, 'Atención');
                        }

                        //if (auditoria.OBJETO != null)
                        //    Tabla_Resultados(auditoria.OBJETO, ID_TABLA);
                        //else {
                        //    html = "<i class=\"clip-close\" style='color:#f30203'></i>&nbsp; <span style='color:#f30203'>Carga con errores</span>";
                        //    $("#lbl_resultado").html(html);
                        //}

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        debugger;
                        alert(jqXHR);
                        window.location = ErrorUrl;
                    }
             
                };
                debugger;
                $("#frmMantenimiento_ImportarExcel").ajaxForm(options);
                $("#frmMantenimiento_ImportarExcel").submit();
            }
        });
    }





</script>
<style>
    #modal-dialog_this {
        margin: 30px auto;
        max-width: 600px;
    }

    #ModalImportar {
        padding: 8px;
        background: #2c7be5 !important;
    }
</style>

<div class="modal fade" id="myModalDescargar" tabindex="" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>

@using (Html.BeginForm("CargarArchivo", "Importar_Producto", new { @area = "Inventario" }, FormMethod.Post, new { @id = "frmMantenimiento_ImportarExcel", @class = "form-horizontal", @enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    <div class="modal-dialog" role="document" id="modal-dialog_this">
        <div class="modal-content">
            <div class="modal-header" id="ModalImportar">
                <h5 class="modal-title"><i class="bi bi-cloud-upload"></i>&nbsp; Carga masiva productos</h5>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body mb-0">
                                <h5 class="card-title">Descarga plantilla excel</h5>
                                <p class="card-text">Para poder importar tus productos en lote debes descargar la plantilla y enviarlo utilizando el mismo formato!.</p>
                                <button type="button" id="Importar_btn_DPlantilla" class="btn btn-outline-success"><i class="bi bi-file-earmark-excel"></i>&nbsp; Descargar Plantilla</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card mb-0">
                            <div class="card-body mb-0">
                                <div class="custom-file mb-3">
                                    <input id="file-upload" type="file" name="fileArchivo" class="custom-file-input" accept=".csv, .xls, .xlsx">
                                    <label class="custom-file-label" for="file-upload" id="Lbl_Namefile">Sin archivo cargado..</label>
                                </div>

                                <div class="alert alert-info alert-dismissible alert-alt fade show">
                                    <strong><i class="bi bi-info-circle text-info"></i>&nbsp;</strong>Todos los productos que se ingresen en el excel,
                                         serán registrados en el almacén para la sucursal:<b> @Model.DESC_SUCURSAL</b> (ID: @Model.ID_SUCURSAL)
                                </div>

                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" id="Producto_Btn_Importar" class="btn btn-hover-shine btn-square btn-primary"><i class="bi bi-cloud-upload"></i>&nbsp; Comenzar carga</button>
                <button type="button" class="btn  btn-square btn-dark" data-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
    @Html.Hidden("ID_SUCURSAL", Model.ID_SUCURSAL);
}